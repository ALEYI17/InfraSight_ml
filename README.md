

# InfraSight ML

This component of the InfraSight platform provides the machine learning models that analyze telemetry collected from eBPF tracers.
Events generated by the `ebpf_loader` are first sent via gRPC to the InfraSight server, which publishes them into Kafka. The ML service (`infrasight_ml`) then consumes these Kafka events, applies both per-container and global anomaly detection models, and produces insights for detection and monitoring.

It is responsible for:

* Consuming telemetry data (e.g., resource usage, syscall frequency) from Kafka topics
* Running **unsupervised anomaly detection models** per container or globally
* Supporting multiple model families (`hst`, `ocSVM`)
* Exposing models for benchmarking and experimentation via Jupyter notebooks
* Providing Docker images that can be run as containers inside the InfraSight ecosystem


## üì¶ Features

* **Per-container & Global models** for:

  * Resource usage events
  * Syscall frequency events
* Multiple anomaly detection techniques:

  * **Half-Space Trees (HST)**
  * **One-Class SVM (ocSVM)**
* Predefined Kafka consumers:

  * `resource-per-container`
  * `resource-global`
  * `syscall-per-container`
* Jupyter notebooks for benchmarking and experimentation
* Containerized with Docker for easy integration in InfraSight



## üß± Technologies Used and Dependencies

* [Python](https://www.python.org/) (>= 3.10)
* [scikit-learn](https://scikit-learn.org/)
* [river](https://riverml.xyz/) for streaming ML models
* [confluent-kafka](https://github.com/confluentinc/confluent-kafka-python)
* [protobuf](https://protobuf.dev/)
* [Jupyter](https://jupyter.org/) for experimentation

## üöÄ Running the Containers

Each model consumer has its own Dockerfile:

* **Resource Global:**

  ```bash
  docker run -it \
    --network ebpf_server_default \
    -e KAFKA_BROKER=broker:29092 \
    ghcr.io/aleyi17/infrasight-resource-global:latest
  ```

* **Resource Per Container:**

  ```bash
  docker run -it \
    --network ebpf_server_default \
    -e KAFKA_BROKER=broker:29092 \
    ghcr.io/aleyi17/infrasight-resource-per-container:latest
  ```

* **Syscall Per Container:**

  ```bash
  docker run -it \
    --network ebpf_server_default \
    -e KAFKA_BROKER=broker:29092 \
    ghcr.io/aleyi17/infrasight-syscall-per-container:latest
  ```


## ‚öôÔ∏è Configuration

These consumers are configured entirely via environment variables:

| Parameter            | Env Variable              | Default               | Description                                                          |
| -------------------- | ------------------------- | --------------------- | -------------------------------------------------------------------- |
| ML Model             | `ML_MODEL`                | `hst`                 | Model to use (`hst` = Half-Space Trees, `ocsvm` = One-Class SVM)     |
| Kafka Broker         | `KAFKA_BROKER`            | `localhost:9092`      | Address of Kafka broker (e.g., `broker:29092` inside Docker network) |
| Kafka Topic          | `KAFKA_TOPIC`             | *depends on consumer* | Kafka topic to consume (`resource`, `frequency`, etc.)               |
| Auto Offset Reset    | `KAFKA_AUTO_OFFSET_RESET` | `earliest`            | Kafka offset policy (`earliest` or `latest`)                         |
| Warmup Size          | `WARMUP_SIZE`             | `3000`                | Number of events to collect before starting detection                |
| Warmup Time (sec)    | `WARMUP_TIME`             | `240`                 | Time window (in seconds) for warm-up phase                           |
| Warmup Size (per c.) | `WARMUP_SIZE_PC`          | `50`                  | Minimum number of events per container for warm-up                   |
| Logging Level        | `LOG_LEVEL`               | `info`                | Logging level (`debug`, `info`, `warn`, `error`)                     |



## üõ†Ô∏è Development Setup

### Clone the repository

```bash
git clone https://github.com/ALEYI17/InfraSight_ml.git
cd InfraSight_ml
```

### Install dependencies

```bash
conda env create -f env.yml
conda activate infrasight-ml
```

or with pip:

```bash
pip install -r requirements.txt
```

### Run a consumer locally

```bash
python -m src.resource_percontainer.main
```


## üìä Notebooks

The `notebooks/` directory contains experiments and benchmarks for different models:

* `resource_model_hst.ipynb`
* `resource_model_ocSVM.ipynb`
* `syscall_frequency_model_hst-percontainer.ipynb`
* ...

You can start Jupyter with:

```bash
jupyter notebook
```



## üìö Related Repositories

This is part of the **[InfraSight](https://github.com/ALEYI17/InfraSight)** platform:

* [`infrasight-controller`](https://github.com/ALEYI17/infrasight-controller): Kubernetes controller to manage agents
* [`ebpf_loader`](https://github.com/ALEYI17/ebpf_loader): Agent that collects and sends eBPF telemetry from nodes
* [`ebpf_server`](https://github.com/ALEYI17/ebpf_server): Receives and stores events (e.g., to ClickHouse)
* [`ebpf_deploy`](https://github.com/ALEYI17/ebpf_deploy): Helm charts to deploy the stack
* [`InfraSight_ml`](https://github.com/ALEYI17/InfraSight_ml): Machine learning models for anomaly detection (this repo)
* [`InfraSight_sentinel`](https://github.com/ALEYI17/InfraSight_sentinel): Rules engine that generates alerts based on predefined detection logic.
